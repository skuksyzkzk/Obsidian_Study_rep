---
cssclasses:
  - dashboard
---
# 동기
학교 사물함을 사용 할 때 매번 결제를 현장에서 카드로 결제하는 불편함이 있었다. 
심지어 내가 신청할 날을 까먹어서 연체가 되는 경우도 빈번하게 존재 
불편함을 해결하고자 CMS 자동이체 프로그램을 만들어서 학교 사물함 금액을 자동이체하는 프로그램 개발 


 > [!d] CMS
 > Cash Management Service
 > 자금 관리 서비스. [은행](https://namu.wiki/w/%EC%9D%80%ED%96%89 "은행")에 직접 가지 않아도 통신과 컴퓨터를 이용하여 거래를 처리할 수 있는 금융자산 결제 방법.
 
 > 즉 자동 이체 서비스
# CMS 구조
 ![[Drawing 2024-03-13 01.02.39.CMS]]
## 참가 기관
- 국민은행 같은 금융기관
- 즉 돈이 빠지는 기관

## 이용기관
- 현대에서 차를 리스 할 경우 현대차가 매달 돈을 징수
- 여기서 현대차 회사가 이용 기관

## 금융 결제원
- 금융 결제원이 중간에서 참가기관별로 분류해서 전송 

### 작동 원리 
> 이용기관에서 금융결제원에게 CMS신청하면 금융 결제원에서 참가기관 별로 분류하여 전송해준다.
> 이때 참가기관에서 잔액부족 등 이유로 다시 결과를 리턴해주면 다시 금결원에서 결과를 이용기관에 리턴해준다.

### 작동 원리(기술적 측면)
이동기관에서 CMS를 신청할 때 금육기관명(실제론 금융기관코드),계좌번호,금액,자동이체 시작일자,종료일자,생년월일 주민번호등의 정보를 기입해서 파일로 만들어 신청한다.

파일 안에는 여러가지 정보가 존재 한 회사라도 당연히 어떤 고객은 국민은행쓰고 신한은행쓰고 다르기에 금결원에서 참가기관별로 분류해서 파일안 정보를 전송한다 

> [!c] 파일
> 파일은 정보들의 집합으로 이루어져있으며 
> 정보들이 각각 정보들 


이때 File을 금결원 서버에  FTP로 전송하여 처리 할수도있고
(고객이 많은 대기업에서 사용하는 방식),
엑셀로 수작업하여 금결원 홈페이지에 업로드 할 수도 있다.
(고객이 적은 작은 회사)

# 실제 서비스 

## CMS 이용기관 입장
### CMS 신청/해지
송신 (EB13) 
- 금결원한테 송신 한다
수신 (EB14)
- 금결원한테 송신후 결과를 영업일 기준 D+2 결과를 수신 
- 수신 받는 결과는 보통 오류난 결과들 잔액이 부족하던지...
- 100명 CMS신청을 송신하여 결과를 만약에 5명 받으면 보통 그 5명이 문제있는 결과들 

> 영업일 기준은 만약 금요일날 신청하면 주말 무시후 
> 월,화 이렇게해서 화욜날 결과 수신 

### CMS 출금의뢰
송신(EB21)
-  한달에 고객이 지정한 자동이체일 전날에 파일을 송신
수신(EB22)
- 자동이체 다음날 결과를 수신 받는다

> [!info]
> 자동이체 날은 보통 한달에 5회 정도로 매월 5일 11일 16일 21일 26일 등등이 있다


> 실제로 고객이 등록한 계좌에서 돈을 뽑아 오는 것 

# 실제 구현 

## 화면 
1. 회사에서 고객의 CMS 등록 내용을 처리
2. 고객 정보 등록 화면 
3. CMS 신청 해지 화면 
4. CMS 신청 해지 내역 조회 화면
5. CMS 관리 화면

## 내용 
> 화면 단의 내용들 

2. 전화번호는 뒷자리를 암호화 해서 DB에 저장해야된다
3. 건별로 신청
4. 과거 history 추후 고객이 컴플레인 걸거나 이럴때 확인
5. 금결원에게 CMS 신청 해지와 출금의뢰를 처리하는 메인 

## 서버
> [!warning] 
> 실제로는 이용기관을 성균관대학교로 등록하면 번호가 부여되고 그것으로 금결원한테  CMS를 신청하는 것이지만 현실적으로 학교랑 협업해서 진행될 가능성이 적다 

### 그래서 자체적으로 서버 구성
서버를 이용기관 서버와 금결원 서버 2개를 구성해서 
이용기관에서 파일을 FTP또는 SFTP로 금결원 서버에 전송하고 
금결원 서버에서 받은 파일을 실제 상황을 모방하기 위해 
로직을 첨가 예를 들어 홀수 열을 오류로 처리하여 결과파일을 생성하는 기능 생성파일을 다시 이용기관 서버에서 FTP로 접속하여 파일을 수신하여 결과 처리 


## DB
### CMS 출금의뢰 (이용기관)
출금의뢰 결과 수신 파일을 읽어서 사전에 등록된 고객계좌에 입금처리하는 batch 프로그램도 존재할수있다 

## 알림
CMS결과를 java spring cron-batch로 특정시간에 자동으로 고객에게 문자또는 알림톡으로 안내 