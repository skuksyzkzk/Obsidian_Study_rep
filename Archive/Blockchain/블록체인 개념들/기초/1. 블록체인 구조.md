> [!tip] REF 
> https://www.codestates.com/blog/content/%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%EA%B5%AC%EC%A1%B0%EC%99%80-%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98
> https://xangle.io/insight/research/630d7a512df69ad4ab188b44

# 블록은 헤더(header)와 바디(body)로 나눠있다.

## 블록 헤더 

> 헤더는 메타데이터, 메타데이터는 블록자체를 설명하는 데이터 

블록의 가장 상단에 위치하기에 블록 헤더라고 불린다 .

![[Pasted image 20240116172658.png]]

1. 버전 : 해당 블록이 비트코인의 어떤 버전을 사용하고 있는 지 표기 
	1. 이후에 존재하는 소프트웨어 프로토콜의 업데이트 추적용도 
2. 이전 블록 헤더 해시 
	1. 이전 블록의 헤더 데이터를 해시한것 
3. 머글 루트 
	1. 머글 루트는 머글 트리의 최상단 데이터 트랜잭션을 각각 해시한후 2개씩 짝을 지어 해시하고, 해시한 데이터끼리 2개씩 또 짝을 지어 해시하는 과정을  한 개의 해시값이 남을 때 까지 반복하는 트리구조 ,여기서 남은 한 개의 해시값이 머글루트 
		## 블록의 유효성 확인 하기 위해서 저장한다 .
			블록체인의 네트워크 정보를 전부 내려 받기에는 무리다. 그러니 머글루트를 
			비교하면 손쉽게 비교 가능 64글자만 비교하면 되기 때문에 
4. 타임스탬프 
	1. 유닉스(UNIX) 시간의 시작인 1970년 1월 1일 자정을 기준, 초 단위로 해당 블록의 채굴 시각이 기록됩니다.
5. 난이도 목표
	1. 블록 생성을 흔히 ‘채굴한다’고 말합니다. 채굴 난이도는 방 안에서 물건을 찾는 것에 비유할 수 있는데요. 방에서 연필같이 작은 물건을 찾는 것이 책상처럼 큰 물건을 찾는 것보다 훨씬 어렵고, 시간이 오래 걸리는 것과 같은 것이죠.
		블록체인은 블록마다 생성된 블록의 높이에 따라 자동으로 난이도 목표를 달리 설정해 채굴되는 속도를 일정하게 유지(비트코인의 경우 10분에 1개)합니다.
6. 논스 
	1. 채굴은 앞서 설명한 5가지 데이터와 논스를 조합해 목표에서 정한 값보다 작은 해시값을 찾는 것입니다. 5가지 데이터는 모두 자동으로 주어지거나, 계산되는 고정값이기 때문에 변숫값을 적용해가며 목푯값보다 낮은 해시값을 찾아야 하는데요. 여기서 변숫값이 바로 논스이죠. 이더리움은 트랜잭션 내에도 논스가 존재합니다.

## 블록 바디 

> 트랜잭션 리스트로 구성되어있다.

## 트랜잭션 
트랜잭션(Transaction)이란, 블록체인이라는 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위

### 비트코인 트랜잭션 구조

- 버전 번호 : 채굴자와 노드가 트랜잭션 처리에 사용할 규칙을 지정하는 데 사용
- 입력 카운터 : 트랜잭션에 포함된 입력의 개수
- 입력 리스트 : 블록의 첫 트랜잭션은 코인베이스 트랜잭션(Coinbase Transaction)으로 입력 리스트에는 하나 이상의 트랜잭션 입력이 포함
- 출력 카운터 : 출력의 개수를 나타내는 양의 정수
- 출력 리스트 : 트랜잭션에 포함된 출력
- 락 시간 : 트랜잭션이 유효해지는 가장 빠른 시간을 정의하는 필드

### 이더리움 트랜잭션 구조

- 논스(Nonce) : 트랜잭션 발신 EOA(지갑)에 의해 발행되어 트랜잭션 메시지 재사용을 방지하는 데 사용되는 일련번호
- 가스 가격(Gas Price) : 발신자가 지급하는 가스(수수료)의 가격으로 이더리움의 가장 작은 단위인 웨이(wei)단위로 기록
- 가스 한도 : 발신하는 트랜잭션을 위해 사용할 가스의 최대치로, 한도를 넘는 가스비가 사용된다면 트랜잭션 실패
- 수신자 : 이 트랜잭션을 받는, 트랜잭션의 목적지 이더리움 주소
- 값 : 목적지에 보낼 이더(이더리움 코인)의 양
- 데이터 : 가변 길이 바이너리 데이터 페이로드로, 스마트 컨트랙트 호출 시 사용
- v, r, s : EOA의 ECDSA 디지털 서명의 세 가지 구성 요소

비트코인과 이더리움 이 **두 네트워크 트랜잭션의 가장 큰 차이는 논스(Nonce)의 유무**입니다. 이더리움 트랜잭션에는 논스가 존재하고, 이 논스는 이중 지불을 방지하는 데 사용합니다.

* 이중 지불(Double Spending) : 원본 파일에 저장된 가치를 지불한 뒤, 해당 파일을 복사하여 다른 사람에게 또 지불하는 것을 의미

**이더리움의 논스는 두 가지 특성**을 가집니다. **트랜잭션 시 논스가 1씩 증가**하며, **한 계정 내 논스는 유일**하고 동일한 논스가 존재하지 않습니다. 한 계정의 트랜잭션들 또한 각각 고유한 논스를 가지고 있으며, 가장 오래된 순서부터 1씩 증가하는 값을 가집니다.

만약 논스가 1인 트랜잭션을 발신한 후 이어서 논스가 2인 트랜잭션을 발신한다면, 두 번째 트랜잭션은 어떤 블록에도 포함되지 않습니다. 두 번째 트랜잭션은 멤풀(Mempool)이라는 임시 저장공간에서 논스가 1인 트랜잭션을 기다리며, 논스가 1인 트랜잭션이 발신되면 멤풀에 있던 트랜잭션 역시 처리되고 블록에 포함됩니다.

같은 논스를 가진 트랜잭션이 다수 발신된 경우에는 가스비(수수료)가 가장 높은 트랜잭션 하나만 처리되며, 이런 방법으로 이더리움은 이중 지불을 방지합니다.

**논스가 존재하지 않는 비트코인은 이중 지불을 어떻게 방지**할까요? 바로 **UTXO(Unspent Transaction Output), 미사용 트랜잭션 출력값을 사용**합니다.

비트코인의 송금은 실제 금액을 발신하고, 수신하는 것이 아닌 송금하는 금액이 적힌 UTXO를 주고받습니다. 트랜잭션을 발생시키면 이 UTXO는 TX Pool에 들어가게 되는데요. 채굴하는 과정에서 이 UTXO에 사용 기록이 있다면 해당 거래를 무효화하는 방식으로 이중 지불을 방지합니다.

	이런 논스의 존재 여부 외에도 비트코인의 트랜잭션은 화폐 송금 기능만 가지고 있다면, 이더리움 트랜잭션은 송금을 넘어 스마트 컨트랙트를 호출하는 용도로도 사용할 수 있다는 차이가 있습니다.